(function(t){function e(e){for(var o,r,i=e[0],l=e[1],c=e[2],d=0,p=[];d<i.length;d++)r=i[d],n[r]&&p.push(n[r][0]),n[r]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);u&&u(e);while(p.length)p.shift()();return s.push.apply(s,c||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],o=!0,i=1;i<a.length;i++){var l=a[i];0!==n[l]&&(o=!1)}o&&(s.splice(e--,1),t=r(r.s=a[0]))}return t}var o={},n={app:0},s=[];function r(e){if(o[e])return o[e].exports;var a=o[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=o,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(a,o,function(e){return t[e]}.bind(null,o));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var u=l;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var o=a("64a9"),n=a.n(o);n.a},1253:function(t,e,a){"use strict";var o=a("feda"),n=a.n(o);n.a},"12a3":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("f751"),a("097d");var o=a("2b0e"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},s=[],r=(a("034f"),a("2877")),i={},l=Object(r["a"])(i,n,s,!1,null,null,null),c=l.exports,u=a("8c4f"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"f-c"},[t.loading?a("Loading"):t._e(),a("div",{staticClass:"form b"},[a("p",{staticClass:"c h3"},[t._v("登录")]),t.error?a("p",{staticClass:"c errmsg"},[t._v(t._s(t.errmsg))]):t._e(),a("input",{directives:[{name:"model",rawName:"v-model",value:t.mail,expression:"mail"}],staticClass:"b m",attrs:{type:"text",placeholder:"邮箱"},domProps:{value:t.mail},on:{input:function(e){e.target.composing||(t.mail=e.target.value)}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"b m",attrs:{type:"password",placeholder:"密码"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),a("input",{staticClass:"b m point",attrs:{type:"submit",value:"登录"},on:{click:t.login}})])],1)},p=[],g=a("2427"),h=a.n(g),f=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},m=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"loading"},[a("div",{staticClass:"loading-circle"})])}],_=(a("ff4b"),{}),w=Object(r["a"])(_,f,m,!1,null,"4fb9d705",null),v=w.exports,x={name:"login",components:{Loading:v},data:function(){return{mail:"",password:"",loading:!1,error:!1,errmsg:""}},mounted:function(){var t=localStorage["txt_reader_user_id"],e=localStorage["txt_reader_user_key"];(t||e)&&location.assign("/#/all")},methods:{login:function(){var t=this;this.loading=!0;var e=new FormData;return this.mail.length<1?(this.error=!0,this.errmsg="请填写邮箱地址",this.loading=!1,!1):this.password.length<1?(this.error=!0,this.errmsg="请填写密码",this.loading=!1,!1):(e.append("m",this.mail),e.append("p",this.password),void h.a.post("/api/user/login",e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){localStorage["txt_reader_user_id"]=t.data.user_id,localStorage["txt_reader_user_key"]=t.data.user_key,location.assign("/#/all")}).catch(function(e){t.errmsg=e.response.data.body,t.error=!0}).finally(function(){t.loading=!1}))}}},b=x,y=(a("d6db"),Object(r["a"])(b,d,p,!1,null,null,null)),k=y.exports,C=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"w-75"},[t.loading?a("Loading"):t._e(),a("div",[a("div",{staticClass:"head"},[a("p",[t._v("Reader")]),a("div",{staticClass:"head-icon"},[a("span",{staticClass:"icon-link",attrs:{title:"刷新"},on:{click:t.get_books}},[a("svg",{attrs:{role:"img",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","aria-labelledby":"refreshIconTitle"}},[a("polyline",{attrs:{points:"22 12 19 15 16 12"}}),a("path",{attrs:{d:"M11,20 C6.581722,20 3,16.418278 3,12 C3,7.581722 6.581722,4 11,4 C15.418278,4 19,7.581722 19,12 L19,14"}})])]),a("router-link",{staticClass:"icon-link",attrs:{to:"/upload"}},[a("span",{staticClass:"icon-link",attrs:{title:"上传"}},[a("svg",{attrs:{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"shareIconTitle"}},[a("path",{attrs:{d:"M12 14V6"}}),a("path",{attrs:{d:"M9 8L12 5L15 8"}}),a("path",{attrs:{d:"M5 13V18H19V13"}})])])]),a("span",{staticClass:"icon-link",attrs:{title:"退出"},on:{click:t.logout}},[a("svg",{attrs:{role:"img",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","aria-labelledby":"exitIconTitle"}},[a("path",{attrs:{d:"M18 15l3-3-3-3"}}),a("path",{attrs:{d:"M11.5 12H20"}}),a("path",{attrs:{"stroke-linecap":"round",d:"M21 12h-1"}}),a("path",{attrs:{d:"M15 4v16H4V4z"}})])])],1)]),t.error?a("p",{staticClass:"c"},[t._v(t._s(t.errmsg))]):t._e(),a("ul",{staticClass:"books"},t._l(this.books,function(e){return a("li",{key:e.book_id,staticClass:"book"},[0==e.book_status?a("span",{staticClass:"book_name_1"},[t._v("已上传 "+t._s(e.book_name))]):t._e(),2==e.book_status?a("span",{staticClass:"book_name_1"},[t._v("解析中 "+t._s(e.book_name))]):t._e(),-1==e.book_status?a("span",{staticClass:"book_name_1"},[t._v("解析失败 "+t._s(e.book_name))]):t._e(),-2==e.book_status?a("span",{staticClass:"book_name_1"},[t._v("解码失败 "+t._s(e.book_name))]):t._e(),1==e.book_status?a("router-link",{staticClass:"book_name_2",attrs:{to:{path:"reader",query:{id:e.book_id}}}},[t._v(t._s(e.book_name))]):t._e()],1)}),0)])],1)},P=[],M={name:"all",components:{Loading:v},data:function(){return{mail:"",password:"",loading:!1,error:!1,errmsg:"",books:[]}},mounted:function(){this.get_books()},methods:{get_books:function(){var t=this;this.loading=!0,h.a.get("/api/book/books",{headers:{"x-user-id":localStorage["txt_reader_user_id"],"x-user-key":localStorage["txt_reader_user_key"]}}).then(function(e){t.books=e.data}).catch(function(e){404==e.response.status&&(t.error=!0,t.errmsg="快去上传一本书籍吧")}).finally(function(){t.loading=!1})},logout:function(){delete localStorage["txt_reader_user_id"],delete localStorage["txt_reader_user_key"],location.assign("/")}}},S=M,T=(a("1253"),Object(r["a"])(S,C,P,!1,null,null,null)),O=T.exports,L=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"f-c"},[t.loading?a("Loading"):t._e(),a("div",{staticClass:"form b"},[a("p",{staticClass:"c h3"},[t._v("上传")]),t.error?a("p",{staticClass:"c errmsg"},[t._v(t._s(t.errmsg))]):t._e(),a("input",{ref:"file",attrs:{type:"file"}}),a("input",{staticClass:"b m point",attrs:{type:"submit",value:"上传"},on:{click:t.upload}})])],1)},j=[],$={name:"upload",components:{Loading:v},data:function(){return{file:"",loading:!1,error:!1,errmsg:""}},mounted:function(){},methods:{upload:function(){var t=this;if(this.file=this.$refs.file.files[0],console.log(this.file),!this.file)return this.error=!0,this.errmsg="请先选择文件",!1;if("text/plain"!=this.file.type)return this.error=!0,this.errmsg="抱歉，只接受 txt 文件",!1;this.loading=!0;var e=new FormData;e.append("file",this.file),h.a.post("/api/book/upload",e,{headers:{"Content-Type":"multipart/form-data","x-user-id":localStorage["txt_reader_user_id"],"x-user-key":localStorage["txt_reader_user_key"]}}).then(function(){location.assign("/#/all")}).catch(function(e){t.errmsg=e.response.data.body,t.error=!0}).finally(function(){t.loading=!1})}}},I=$,E=Object(r["a"])(I,L,j,!1,null,null,null),H=E.exports,B=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"reader"},[t.loading?a("Loading"):t._e(),t.now.show_catalogue?a("ReaderCatalogue",{attrs:{now:t.now}}):t._e(),t.now.chapter?a("div",{ref:"text",staticClass:"text",domProps:{innerHTML:t._s("<p>"+this.now.catalog[this.now.index][1]+"</p>"+this.now.chapter)},on:{click:function(e){t.show_control=!t.show_control}}}):t._e(),t.show_control?a("ul",{staticClass:"control"},[a("li",[a("span",{on:{click:function(e){t.now.index--,t.show_control=!t.show_control}}},[a("svg",{attrs:{role:"img",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","aria-labelledby":"circleArrowLeftIconTitle"}},[a("path",{attrs:{d:"M10.5 15l-3-3 3-3"}}),a("path",{attrs:{d:"M16.5 12H9"}}),a("path",{attrs:{"stroke-linecap":"round",d:"M7.5 12H9"}}),a("circle",{attrs:{cx:"12",cy:"12",r:"10"}})])]),a("span",{on:{click:function(e){t.now.show_catalogue=!t.now.show_catalogue,t.show_control=!t.show_control}}},[a("svg",{attrs:{role:"img",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","aria-labelledby":"listIconTitle"}},[a("path",{attrs:{d:"M10 7L18 7M10 12L18 12M10 17L18 17"}}),a("line",{attrs:{x1:"7",y1:"7",x2:"7",y2:"7"}}),a("line",{attrs:{x1:"7",y1:"12",x2:"7",y2:"12"}}),a("line",{attrs:{x1:"7",y1:"17",x2:"7",y2:"17"}})])]),a("span",{on:{click:function(e){t.now.index++,t.show_control=!t.show_control}}},[a("svg",{attrs:{role:"img",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","aria-labelledby":"circleArrowRightIconTitle"}},[a("path",{attrs:{d:"M13.5 9l3 3-3 3"}}),a("path",{attrs:{d:"M7.5 12H15"}}),a("path",{attrs:{"stroke-linecap":"round",d:"M16.5 12H15"}}),a("circle",{attrs:{cx:"12",cy:"12",r:"10"}})])])])]):t._e()],1)},N=[],R=(a("a481"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.now.catalog?a("ul",{directives:[{name:"scollTop",rawName:"v-scollTop"}],staticClass:"readerCatalogue"},[a("div",{staticClass:"readerCatalogueContent"},t._l(t.range(t.page*t.pageCapacity-t.pageCapacity,t.page*t.pageCapacity<t.totalIndex?t.page*t.pageCapacity:t.totalIndex),function(e){return a("li",{key:e,on:{click:function(a){t.now.index=e,t.now.show_catalogue=!1}}},[a("p",{staticClass:"catalogueText"},[t._v(t._s(t.now.catalog[e][1]))])])}),0),a("div",{staticClass:"readerCatalogueControlBar"},[a("p",{on:{click:function(e){t.page>1?t.page--:t.page=1,t.cusPage=t.page}}},[t._v("上一页")]),a("p",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.cusPage,expression:"cusPage"}],attrs:{type:"text",placeholder:"1 - "+this.maxPage},domProps:{value:t.cusPage},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.loadCusPage(e)},input:function(e){e.target.composing||(t.cusPage=e.target.value)}}})]),a("p",{on:{click:function(e){t.page<t.maxPage?t.page++:t.page=t.maxPage,t.cusPage=t.page}}},[t._v("下一页")])]),a("div",{staticClass:"readerCatalogueMask",on:{click:function(e){t.now.show_catalogue=!1}}})]):t._e()}),V=[],D={name:"Reader_catalogue",directives:{scollTop:{update:function(t){t.scrollTop=0}}},props:{now:Object},mounted:function(){this.totalIndex=this.now.catalog.length,this.maxPage=Math.floor(this.totalIndex/this.pageCapacity)+1,this.page=Math.floor(this.now.index/this.pageCapacity)+1},data:function(){return{totalIndex:null,page:1,pageCapacity:50,maxPage:null,cusPage:null}},methods:{loadCusPage:function(){if(!this.cusPage||!this.maxPage)return!1;this.cusPage<=this.maxPage&&this.cusPage>0&&(this.page=this.cusPage)},range:function(t,e){if(e-t>0){var a=[];while(t<e)a.push(t),t+=1;return a}}}},F=D,q=(a("f014"),Object(r["a"])(F,R,V,!1,null,"6315918b",null)),A=q.exports,J={name:"reader",components:{Loading:v,ReaderCatalogue:A},data:function(){return{now:{id:"",index:0,catalog:"",chapter:"",show_catalogue:!1},show_control:!1,loading:!1}},directives:{scollTop:{update:function(t){t.scrollTop=0}}},mounted:function(){this.now.id=this.$route.query.id,console.log(this.now.id),localStorage[this.now.id]||(localStorage[this.now.id]=0),this.now.index=localStorage[this.now.id],this.load_catalog(this.now.id)},methods:{load_catalog:function(t){var e=this;this.loading=!0,h.a.get("/api/book/catalogue/"+t,{headers:{"x-user-id":localStorage["txt_reader_user_id"],"x-user-key":localStorage["txt_reader_user_key"]}}).then(function(t){e.now.catalog=t.data,e.load_chapter()}).catch(function(){alert("加载目录失败")}).finally(function(){e.loading=!1})},load_chapter:function(){var t=this;h.a.get("/api/book/chapter/"+this.now.id+"/"+this.now.index,{headers:{"x-user-id":localStorage["txt_reader_user_id"],"x-user-key":localStorage["txt_reader_user_key"]}}).then(function(e){t.now.chapter="<p>"+e.data[1].replace(/\n\n/g,"\n").replace(/\n/g,"</p><p>").replace(/\s/g,"")+"</p>"}).then(function(){document.title=t.now.catalog[t.now.index][1],localStorage[t.now.id]=t.now.index})}},watch:{"now.index":function(){return!!this.now.catalog&&(console.log("索引变化，即将加载需要的章节"),this.now.index<0?(this.now.index=0,alert("已经是开头了！"),!1):this.now.index>=this.now.catalog.length?(this.now.index=this.now.catalog.length-1,alert("读完了喔！"),!1):(this.load_chapter(),void(this.$refs.text.scrollTop=0)))}}},z=J,G=(a("d207"),Object(r["a"])(z,B,N,!1,null,null,null)),K=G.exports,Q=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"f-c"},[t.loading?a("Loading"):t._e(),a("div",{staticClass:"form b"},[a("p",{staticClass:"c h3"},[t._v("注册")]),t.error?a("p",{staticClass:"c errmsg"},[t._v(t._s(t.errmsg))]):t._e(),a("input",{directives:[{name:"model",rawName:"v-model",value:t.mail,expression:"mail"}],staticClass:"b m",attrs:{type:"text",placeholder:"邮箱"},domProps:{value:t.mail},on:{input:function(e){e.target.composing||(t.mail=e.target.value)}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"b m",attrs:{type:"password",placeholder:"密码"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),a("input",{directives:[{name:"model",rawName:"v-model",value:t.password2,expression:"password2"}],staticClass:"b m",attrs:{type:"password",placeholder:"重复密码"},domProps:{value:t.password2},on:{input:function(e){e.target.composing||(t.password2=e.target.value)}}}),a("input",{staticClass:"b m point",attrs:{type:"submit",value:"注册"},on:{click:t.login}})])],1)},U=[],W={name:"login",components:{Loading:v},data:function(){return{mail:"",password:"",password2:"",loading:!1,error:!1,errmsg:""}},mounted:function(){var t=localStorage["txt_reader_user_id"],e=localStorage["txt_reader_user_key"];(t||e)&&location.assign("/#/all")},methods:{login:function(){var t=this;this.loading=!0;var e=new FormData;return this.mail.length<1?(this.error=!0,this.errmsg="请填写邮箱地址",this.loading=!1,!1):this.password.length<1?(this.error=!0,this.errmsg="请填写密码",this.loading=!1,!1):this.password2.length<1?(this.error=!0,this.errmsg="请填写密码",this.loading=!1,!1):this.password!=this.password2?(this.error=!0,this.errmsg="两次密码不一致",this.loading=!1,!1):(e.append("m",this.mail),e.append("p1",this.password),e.append("p2",this.password2),void h.a.post("/api/user/new",e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(){location.assign("/"),alert("注册成功！")}).catch(function(e){t.errmsg=e.response.data.body,t.error=!0}).finally(function(){t.loading=!1}))}}},X=W,Y=(a("e42b"),Object(r["a"])(X,Q,U,!1,null,null,null)),Z=Y.exports;o["a"].use(u["a"]);var tt=new u["a"]({routes:[{path:"/",name:"login",component:k},{path:"/all",name:"all",component:O},{path:"/upload",name:"upload",component:H},{path:"/reader",name:"reader",component:K},{path:"/signup",name:"signup",component:Z}]});o["a"].config.productionTip=!1,new o["a"]({router:tt,render:function(t){return t(c)}}).$mount("#app")},"64a9":function(t,e,a){},"8f13":function(t,e,a){},9150:function(t,e,a){},a9e7:function(t,e,a){},bc0f:function(t,e,a){},d207:function(t,e,a){"use strict";var o=a("9150"),n=a.n(o);n.a},d6db:function(t,e,a){"use strict";var o=a("a9e7"),n=a.n(o);n.a},e42b:function(t,e,a){"use strict";var o=a("12a3"),n=a.n(o);n.a},f014:function(t,e,a){"use strict";var o=a("bc0f"),n=a.n(o);n.a},feda:function(t,e,a){},ff4b:function(t,e,a){"use strict";var o=a("8f13"),n=a.n(o);n.a}});
//# sourceMappingURL=app.ef3ad600.js.map